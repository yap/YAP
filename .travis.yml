# Use Ubuntu 14.04
sudo: required
dist: trusty

# Set the language
language: cpp

# Set the compiler
compiler:
    - gcc

# Sent e-mails if the build fail
notification:
    email:
        on_success: change
        on_failure: always

before_install:
      - echo -n | openssl s_client -connect scan.coverity.com:443 | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' | sudo tee -a /etc/ssl/certs/ca-

addons:
  coverity_scan:
    project:
      name: "yap/YAP"
      description: "Build submitted via Travis CI"
    notification_email: certain@gmail.com
    build_command_prepend: "cd ${TRAVIS_BUILD_DIR} && mkdir build && cd build && cmake .."
    build_command:   "make -j4 test D3piTest D4piTest"
    branch_pattern: coverity_scan
    
# Install build packages
install:
    # Check if cmake is installed and, if not, installs it
    - $(which cmake > /dev/null) || (sudo apt-get update && sudo apt-get install cmake) && echo "cmake installed"
    # TODO find a way to get the particle table w/o this environment variable
    - export YAPDIR="$PWD"

script:
 - if [ "${COVERITY_SCAN_BRANCH}" != 1 ]; then
   cd ${TRAVIS_BUILD_DIR} && mkdir build && cd build && cmake .. && make -j4 test D3piTest D4piTest;
   fi
